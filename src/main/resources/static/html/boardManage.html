<!DOCTYPE html>
<html lang="en"
	  xmlns:th="http://www.thymeleaf.org"
	  xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">

<head>
    <meta charset="UTF-8">
    <title>工资管理主页</title>
    <link rel="stylesheet" href="css/bootstrap.css"/>
    <link rel="stylesheet" type="text/css" href="../layui/css/layui.css"/>
	<script type="text/javascript" rel="stylesheet" src="../js/jquery-1.12.4.js"></script>
	<script type="text/javascript" rel="stylesheet" src="../js/ajaxUtil.js"></script>
    <script type="text/javascript" src="../layui/layui.js"></script>
	<script type="text/javascript" src="../js/modi_psw.js"></script>

</head>
<body class="layui-layout-body">

<!--顶端导航-->

<div class="layui-layout layui-layout-admin">
    <div class="layui-header">
        <div class="layui-logo ">企业工资管理系统</div>
        <ul class="layui-nav layui-layout-right">
            <li class="layui-nav-item" lay-unselect="">
                <a href="javascript:;"><img src="/Info/person" class="layui-nav-img"><span id="xm">xingming</span></a>
                <dl class="layui-nav-child">
					<dd><a data-method="notice" id="passwd">&nbsp;修改密码</a></dd>

                </dl>
            </li>
            <!--<li class="layui-nav-item">
                  用户欢迎您！
            </li>-->
            <li class="layui-nav-item"><a href="http://localhost:8080/html/onload.html" style="text-decoration:none">退出登录</a></li>
        </ul>

    </div>

    <!--侧边栏导航-->
    <div  class="layui-side layui-bg-black">
        <ul class="layui-nav layui-nav-tree layui-inline" lay-filter="demo" style="margin-right: 10px;">
            <li class="layui-nav-item ">
				<a  href="http://localhost:8080/html/mainpage.html">主页</a>
				<dl class="layui-nav-child">
					<dd><a href="http://localhost:8080/html/modifyPage.html">修改信息</a></dd>
				</dl>
            </li>
            <!--工资信息表，奖惩记录，工资数据图展示过去12个月的工资图-->
            <li class="layui-nav-item">
				<a href="http://localhost:8080/html/salaryPage.html">我的工资信息</a>
            </li>
            <li class="layui-nav-item  layui-nav-itemed">
				<a href="http://localhost:8080/html/boardPage.html">我的公告</a>
				<shiro:hasPermission name="sys:rs:board">
				<dl class="layui-nav-child">
					<dd><a class="layui-this"  href="http://localhost:8080/html/boardManage.html">公告管理</a></dd>
				</dl>
				</shiro:hasPermission>
            </li>
			<!--管理员工工资，员工信息-->
			<shiro:hasPermission name="sys:rs:stuff">
			<li class="layui-nav-item">
				<a href="http://localhost:8080/html/stuffManagePage.html">员工管理</a>
			</li>
			</shiro:hasPermission>
			<!--			财务管理-->
			<shiro:hasPermission name="sys:cw:wage">
			<li class="layui-nav-item"><a href="http://localhost:8080/html/salaryManagePage.html">财务管理</a></li>
			</shiro:hasPermission>
            <!--角色权限管理-->
			<shiro:hasPermission name="sys:admin">
            <li class="layui-nav-item"><a href="http://localhost:8080/html/powerPage.html">角色管理</a></li>
			</shiro:hasPermission>
        </ul>
    </div>

    <!-- 内容主体区域 -->
    <div class="layui-body" style="background: #F0F0F0; margin-bottom: -45px;">
		<div style="padding: 30px;">
			<div class="layui-tab layui-tab-card" style="height: 600px;">
			  <ul class="layui-tab-title">
			    <li class="layui-this">所有公告</li>
			    <li>公告发布</li>
			  </ul>
			  <div class="layui-tab-content" style="height: 100px;" >
			  	
			  	<!--所有公告-->
			    <div class="layui-tab-item layui-show" style="padding: -40px;">
					<table class="layui-hide" id = "idTest" lay-filter="test"></table>
		
				<script type="text/html" id="barDemo">
		  <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
		  <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
		</script>

			    </div>
			    
			    <!--公告发布-->
			    <div class="layui-tab-item">
			    	
			  <form class="layui-form" id="subform" action="">
			  	
			  	 <div class="layui-form-item">
				    <label class="layui-form-label">标题：</label>
				    <div class="layui-input-block">
				      <input type="text" name="title" id="title" lay-verify="required"  autocomplete="off" placeholder="请输入标题" class="layui-input">
				    </div>
				  </div>
				  
				  <div class="layui-form-item layui-form-text">
				    <label class="layui-form-label">内容：</label>
				    <div class="layui-input-block">
				      <textarea placeholder="请输入内容" id="content" lay-verify="required" class="layui-textarea"></textarea>
				    </div>
				  </div>
				  
				   <div class="layui-form-item">
				    <div class="layui-input-block">
				
				      <button type="submit" class="layui-btn" id="upload" lay-submit="" lay-filter="formDemo">立即发布</button>

				    </div>
				   </div>
  
			  </form>
			    	
			    </div>
			  </div>
			</div>
		</div>
    </div>
</div>

</body>
<script type="text/javascript">

	window.onload = function() {
		ajax({
			method:HTTP_METHOD.POST,
			url:"/Info/getInfo",
			async:true,
			type:HTTP_RESPONSE_TYPE.JSON,
			callback:(data)=>{

				var json = eval(data);
				$("#xm").text(json.uname);

			}
		})
	}





    layui.use('element', function(){
        var element = layui.element;



    });
    layui.use('table', function(){

  var table = layui.table;

		table.render({
			elem: '#idTest'
			,url:'/BoardInfo/getAll'
			,page: true
			,limit:10
			,cols: [
					[
				{field:'unum', width:150, sort: true, fixed: true,title:'ID'}
				,{field:'uname',fixed: true, width:100,title:'发布者'}
				,{field:'time', fixed: true, width:150, sort: true,title:'时间'}
				,{field:'title', fixed: true, width:150, sort: true,title:'标题'}
				,{field:'content', width:600,title:'内容'}
				,{fixed: 'right', width:200,  toolbar: '#barDemo',title:'操作'}

			]
			]

		});

  //监听表格复选框选择
  // table.on('checkbox(demo)', function(obj){
  //   console.log(obj)
  // });
  //监听工具条
  table.on('tool(test)', function(obj){
    var data = obj.data;
    var json = eval(data);
	  if(obj.event === 'detail'){
		  layer.msg('公告内容：'+ json.content);
	  } else if(obj.event === 'del'){

      layer.confirm('您确定要删除这条公告吗?',{btn: ['确定', '取消'],title:"提示"}, function(index){
      	var bnum = json.bnum;

      	$.post(
      			"/BoardInfo/DelRow",
				{bnum : bnum},
				function (datas) {
      				if (datas == "1"){
						obj.del();


					}else {
      					layer.alert("删除失败！");

					}

				}
		)
		  layer.close(index);


      });
    }
  });
  

  
  // $('.demoTable .layui-btn').on('click', function(){
  //   var type = $(this).data('type');
  //   active[type] ? active[type].call(this) : '';
  // });
});
    layui.use('form',function () {
    	var form = layui.form;

		//监听提交
		form.on('submit(formDemo)', function(data){
			var title = $("#title").val();
			var content = $("#content").val();

			$.ajax({
				type:'POST',
				url:"/BoardInfo/newBoard",
				data:{title:title,content:content},
				success:function(data){
					layer.alert("发布成功!");
					$("#subform")[0].reset();
					form.render();
				},
				error:function() {
					layer.alert("发布失败!请尝试重新发布。");
				}
			});
			return false;
		});

	})

</script>
</html>