<!DOCTYPE html>
<html lang="en"
	  xmlns:th="http://www.thymeleaf.org"
	  xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <meta charset="UTF-8">
    <title>工资管理主页</title>
    <link rel="stylesheet" href="css/bootstrap.css"/>
    <link rel="stylesheet" type="text/css" href="../layui/css/layui.css"/>
	<script type="text/javascript" rel="stylesheet" src="../js/jquery-1.12.4.js"></script>
	<script type="text/javascript" rel="stylesheet" src="../js/ajaxUtil.js"></script>
    <script type="text/javascript" src="../layui/layui.js"></script>
	<script type="text/javascript" src="../js/modi_psw.js"></script>

</head>
<body class="layui-layout-body">

<!--顶端导航-->

<div class="layui-layout layui-layout-admin">
    <div class="layui-header">
        <div class="layui-logo ">企业工资管理系统</div>
        <ul class="layui-nav layui-layout-right">
            <li class="layui-nav-item" lay-unselect="">
                <a href="javascript:;"><img src="/Info/person" class="layui-nav-img"><span id="xm">xingming</span></a>
                <dl class="layui-nav-child">
					<dd><a data-method="notice" id="passwd">&nbsp;修改密码</a></dd>

                </dl>
            </li>
            <!--<li class="layui-nav-item">
                  用户欢迎您！
            </li>-->
            <li class="layui-nav-item"><a href="http://localhost:8080/html/onload.html" style="text-decoration:none">退出登录</a></li>
        </ul>

    </div>

    <!--侧边栏导航-->
    <div  class="layui-side layui-bg-black">
        <ul class="layui-nav layui-nav-tree layui-inline" lay-filter="demo" style="margin-right: 10px;">
            <li class="layui-nav-item layui-nav-itemed">
				<a  href="http://localhost:8080/html/mainpage.html">主页</a>
				<dl class="layui-nav-child">
					<dd><a href="http://localhost:8080/html/modifyPage.html">修改信息</a></dd>
				</dl>
            </li>
            <!--工资信息表，奖惩记录，工资数据图展示过去12个月的工资图-->
            <li class="layui-nav-item">
				<a href="http://localhost:8080/html/salaryPage.html">我的工资信息</a>
            </li>
            <li class="layui-nav-item">
				<a href="http://localhost:8080/html/boardPage.html">我的公告</a>

				<dl class="layui-nav-child">
					<dd><a  href="http://localhost:8080/html/boardManage.html">公告管理</a></dd>
				</dl>
            </li>
			<!--管理员工工资，员工信息-->
			<li class="layui-nav-item">
				<a href="http://localhost:8080/html/stuffManagePage.html">员工管理</a>
			</li>
			<!--			财务管理-->
			<li class="layui-nav-item"><a href="http://localhost:8080/html/salaryManagePage.html">财务管理</a></li>

            <!--角色权限管理-->
            <li class="layui-nav-item"><a class="layui-this" href="http://localhost:8080/html/powerPage.html">角色管理</a></li>
        </ul>
    </div>

    <!-- 内容主体区域 -->
     <div class="layui-body" style="margin-bottom: -45px;">
	    <!-- 内容主体区域 -->
	    <div style="padding: 30px;">
	    	
	    	
			 
			<div class="layui-tab layui-tab-card" style="height: 500px;">
			  <ul class="layui-tab-title">
			    <li class="layui-this">人员一览</li>
<!--			    <li>权限修改</li>-->
			  </ul>
			  <div class="layui-tab-content" style="height: 100px;" >
			  	
			  	<!--人员一览-->
			    <div class="layui-tab-item layui-show" style="padding: -40px;">
					<table class="layui-hide" id="table"lay-filter="test"></table>
					<script type="text/html" id="barDemo">
						<a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看权限</a>
						<a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="add">增加权限</a>
						<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除权限</a>
					</script>
			    </div>
			    

			  </div>
			</div>
	    	
	    </div>
	  </div>
</div>

</body>
<script type="text/javascript">

	window.onload = function() {
		ajax({
			method:HTTP_METHOD.POST,
			url:"/Info/getInfo",
			async:true,
			type:HTTP_RESPONSE_TYPE.JSON,
			callback:(data)=>{

				var json = eval(data);
				$("#xm").text(json.uname);

			}
		})
	}


    layui.use('element', function(){
        var element = layui.element;

    });
    
    
    	layui.use('table', function(){
	  var table = layui.table;
	  
	  table.render({
	    elem: '#table'
	    ,url:'/Roles/getRoles'
		  ,page: true
		  ,limit:10
	    ,cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
	    ,cols: [
	    		[
	      {field:'unum', title: '职工号', sort: true, align: 'center'}
	      ,{field:'uname', title: '姓名', align: 'center'} //width 支持：数字、百分比和不填写。你还可以通过 minWidth 参数局部定义当前单元格的最小宽度，layui 2.2.1 新增
	      ,{field:'role', title: '角色', sort: true, align: 'center'}
	      ,{fixed: 'right', width:300,  toolbar: '#barDemo',title:'操作'}
	    	]
		  ]
	  });

			//监听工具条
			table.on('tool(test)', function(obj){
				var data = obj.data;
				var json = eval(data);
				if(obj.event === 'detail'){
					$.post(
							"/Roles/getPermission",
							{unum : json.unum},
							function (datas) {
								var content = eval(datas)
								if (datas != "0"){

									layer.msg('权限内容：'+ content);
								}else {
									layer.msg('权限内容：无');

								}

							}
					)

				} else if(obj.event === 'add'){
					var util = layui.util;
					layer.open({
						type: 1
						,title: '角色管理'
						,closeBtn: false
						,area: '300px;'
						,shade: 0.8
						,id: 'LAY_layuipro' //设定一个id，防止重复弹出
						,btn: ['登记', '取消']
						,btnAlign: 'c'
						// ,offset:'b'
						,moveType: 1 //拖拽模式，0或者1
						,content:  '<div style="padding: 50px; line-height: 22px; background-color: #393D49;  font-weight: 300;">' +
								'<form class="layui-form" id="change_password">' +
								'<input type="text" name="unum" id="fnum" lay-verify="num" disabled = "disabled" autocomplete="off" placeholder="工号" class="layui-input"  style="color: #000000"><br>'+
								'<input type="text" name="uname" id="fname" lay-verify="name" disabled = "disabled" autocomplete="off" placeholder="姓名" class="layui-input"  style="color: #000000"><br>'+
								'<select  name="role" id="role"  lay-verify="role" lay-search="">' +
								'<option value="02">普通员工</option>' +
								'<option value="03">财务</option>' +
								'<option value="04">人事</option>' +
								'</select>'+
								'<br><br><br><br><br><br>'+
								'</form>' +
								'</div>'
						,success: function(layero) {
							layui.use('form', function(){
								var form = layui.form;
								form.render();
							});

							var fnum = json.unum;
							var fname = json.uname;
							$("#fnum").val(fnum);
							$("#fname").val(fname);

							var btn = layero.find('.layui-layer-btn');
							btn.find('.layui-layer-btn0').click(function () {
								var role = util.escape($("#role").val());

								$.ajax({
									type: 'POST',
									url: "/Roles/add",
									data: {role:role,unum:json.unum},
									success: function (data) {
										if (data == "-1") {
											layer.alert("请勿重复添加角色");
										} else if (data == "0") {
											layer.alert("添加出错！请重新尝试。");
										} else if (data == "1") {
											layer.alert("角色信息添加成功");
										}
									},
									error: function () {
										layer.alert("添加失败!请尝试重新添加。");
									}
								})

							})
						}
					});

				}else if(obj.event === 'del'){
					var util = layui.util;
					layer.open({
						type: 1
						,title: '角色管理'
						,closeBtn: false
						,area: '300px;'
						,shade: 0.8
						,id: 'LAY_layuipro' //设定一个id，防止重复弹出
						,btn: ['删除', '取消']
						,btnAlign: 'c'
						// ,offset:'b'
						,moveType: 1 //拖拽模式，0或者1
						,content:  '<div style="padding: 50px; line-height: 22px; background-color: #393D49;  font-weight: 300;">' +
								'<form class="layui-form" id="change_password">' +
								'<input type="text" name="unum" id="fnum" lay-verify="num" disabled = "disabled" autocomplete="off" placeholder="工号" class="layui-input"  style="color: #000000"><br>'+
								'<input type="text" name="uname" id="fname" lay-verify="name" disabled = "disabled" autocomplete="off" placeholder="姓名" class="layui-input"  style="color: #000000"><br>'+
								'<select  name="role" id="role"  lay-verify="role" lay-search="">' +
								'<option value="02">普通员工</option>' +
								'<option value="03">财务</option>' +
								'<option value="04">人事</option>' +
								'</select>'+
								'<br><br><br><br><br><br>'+
								'</form>' +
								'</div>'
						,success: function(layero) {
							layui.use('form', function(){
								var form = layui.form;
								form.render();
							});

							var fnum = json.unum;
							var fname = json.uname;
							$("#fnum").val(fnum);
							$("#fname").val(fname);

							var btn = layero.find('.layui-layer-btn');
							btn.find('.layui-layer-btn0').click(function () {
								var role = util.escape($("#role").val());

								$.ajax({
									type: 'POST',
									url: "/Roles/del",
									data: {role:role,unum:json.unum},
									success: function (data) {
										if (data == "-1") {
											layer.alert("该用户没有此类角色权限");
										} else if (data == "0") {
											layer.alert("删除出错！请重新尝试。");
										} else if (data == "1") {
											layer.alert("角色信息删除成功");
										}
									},
									error: function () {
										layer.alert("添加失败!请尝试重新添加。");
									}
								})

							})
						}
					});
				}
			});

	});
</script>
</html>